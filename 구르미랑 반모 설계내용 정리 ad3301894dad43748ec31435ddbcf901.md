# 구르미랑 반모 설계내용 정리(react-native)

# 담당영역

### 마이페이지

- ui 설계
- 리덕스 액션, 액션함수, 리듀서 설계
- ui 이미지

![KakaoTalk_Photo_2021-10-29-23-43-35 010](https://user-images.githubusercontent.com/73742422/139526657-89ba0db2-502b-46a2-a320-ede21724904b.jpeg)

![KakaoTalk_Photo_2021-10-29-23-43-34 001](https://user-images.githubusercontent.com/73742422/139526682-f48be041-9747-4260-bfac-a8852d81f991.jpeg)

![KakaoTalk_Photo_2021-10-29-23-43-35 003](https://user-images.githubusercontent.com/73742422/139526686-4bbc5f6a-fc8a-4be1-a6e6-9e0208e2a2cd.jpeg)

![KakaoTalk_Photo_2021-10-29-23-43-35 004](https://user-images.githubusercontent.com/73742422/139526690-72b14220-d2d4-42f9-b50c-e054c154f811.jpeg)

### 반려생활

- ui 설계
- 리덕스 액션, 액션함수, 리듀서 설계
- 위치기반 서비스 개발(네이버 지도, reverse geocoding, gps)
    - 네이버 지도 연결
        - 연결 설정
            - 안드로이드
                - 네이버 인증키 연결(경로: "./android/app/src/main/AndroidManifest.xml")
                - sdk 레포지토리 경로 설정
                - 네이버 sdk 버전 싱크
            - ios
                - 네이버 인증키 연결(경로: "./ios/{프로젝트 명}/info.plist")
                - git-lfs 설치
                    
                    ios 환경에서는 네이버 맵의 사이즈가 너무커져서 100MB이상의 고용량 파일을 받기위해 git-lfs를 설치해야 사용이 가능하다(네이버 공식문서에도 나와있음)
                    
                - 네이버 sdk 버전 싱크
        - 실행 코드
            
            ```jsx
            const NaverMap = ({
                list, 
                center, 
                pinClick, 
                showMyLoc,
                isInit,
                setInit, 
                viewOpen, 
                setViewOpen, 
                pinIdx, 
                setShowMyLoc
            }) => {
                const [zoomLevel, setZoomLevel] = useState(16);
                const [smallRndSize, setSmallRndSize] = useState(10);
                const [smallRndOutSize, setSmallRndOutSize] = useState(5);
                const [bigRndSize, setBigRndSize] = useState(50);
                const [currentCenter, setCurrentCenter] = useState({...center});
                const [cnt, setCnt] = useState(0);
            
                const mapRef = useRef();
            
            	// 현재위치 조회시 현재위치 좌표 변경(자체기능 구현, 네이버 제공기능 X)
                useEffect(() => {
                    if(showMyLoc) {
                        console.log('--------------------useEffect---------------------------------');
                        mapRef.current.animateToCoordinate(center);
                        setCnt(0);
                        setCurrentCenter({
                            ...center
                        });
                    }
                }, [showMyLoc]);
            
            		// 지도 축척 변경시 현재위치 아이콘 사이즈 계산
                const sizeCalculate = (zoom) => {
                    console.log('----------------------------sizeCalculate--------------------------');
                    setZoomLevel(zoom);
                    if(zoom > 19) {
                        setSmallRndSize(0.5);
                        setSmallRndOutSize(2.5);
                        setBigRndSize(5);
                    }
                    else {
                        const compZoom = Math.floor(zoom);
                        switch(compZoom) {
                            case 19:
                                setSmallRndSize(1);
                                setSmallRndOutSize(1);
                                setBigRndSize(10);
                                break;
                            case 18:
                                setSmallRndSize(3);
                                setSmallRndOutSize(Platform.OS === 'android' ? 7 : 3);
                                setBigRndSize(20);
                                break;
                            case 17:
                                setSmallRndSize(5);
                                setSmallRndOutSize(Platform.OS === 'android' ? 7 : 3);
                                setBigRndSize(40);
                                break;
                            case 16:
                                setSmallRndSize(10);
                                setSmallRndOutSize(Platform.OS === 'android' ? 7 : 3);
                                setBigRndSize(50);
                                break;
                            default:
                                setSmallRndSize((2 ** (16-compZoom))*10);
                                setSmallRndOutSize(Platform.OS === 'android' ? 7 : 3);
                                setBigRndSize((2 ** (15-compZoom))*100); 
                                break;
                        }
                    }
                }
            
                return (
                    <NaverMapView 
                        ref={mapRef}
                        style={{flex: 1}}        
                        showsMyLocationButton={false}
                        center={{...center, zoom: zoomLevel}}
                        onTouch={e => {
                            console.log('onTouch', e)
                        }}
                        onCameraChange={e => {
                            console.log('onCameraChange', e);
                            const latitude = e.latitude.toFixed(7);
                            const longitude = e.longitude.toFixed(7);
                            const lat1 = currentCenter.latitude.toFixed(7);
                            const long1 = currentCenter.longitude.toFixed(7);
            
                            if((latitude == lat1) && (longitude == long1)) sizeCalculate(e.zoom);
            
                            if(cnt >= 2) {
                                if((latitude != lat1) || (longitude != long1)) {
                                    if(isInit) setInit(false);
                                }
                            }
                            if(cnt >= 1) {
                                if((!isInit) && ((latitude != lat1) || (longitude != long1))) setShowMyLoc(false);
                            }
                            setCnt(cnt+1);
                            
                        }}
                        onMapClick={e => {
                            console.log('onMapClick', e)
                            if(viewOpen) setViewOpen(false);
                        }}
                        zoomGesturesEnabled={true}
                        zoomControl={true}
                    >
                        {/* <Marker coordinate={P0} onClick={() => console.log('onClick! p0')}/> */}
                        {
                            list.map((item) => {
                                const {idx, coordinatesX, coordinatesY, title} = item;
                                return (
                                    <Marker 
                                        coordinate={{latitude: coordinatesY, longitude: coordinatesX}}  
                                        image={ICON_MAP_MARKERPIN}
                                        onClick={() => {
                                            pinClick(item)
                                        }}
                                        width={((pinIdx === idx)&&viewOpen) ? 48 : 37}
                                        height={((pinIdx === idx)&&viewOpen) ? 57 : 45}
                                        key={idx}
                                        caption={{
                                            text: title,
                                            textSize: 13,
                                            color: '#2C2C2E',
                                        }}
                                    />
                                );
                            })
                        }
            
                        { (showMyLoc || isInit) && <Circle coordinate={{...center}} radius={smallRndSize} color={'#FF3B30'} outlineColor={'#fff'} outlineWidth={smallRndOutSize} />}
                        { (showMyLoc || isInit) && <Circle coordinate={{...center}} radius={bigRndSize} color={'#FF3B301A'} outlineWidth={1} outlineColor={'#FF3B30'} />}
                    </NaverMapView>
                );
            }
            ```
            
        - 실행 결과
        
        ![KakaoTalk_Photo_2021-10-29-23-43-35 009](https://user-images.githubusercontent.com/73742422/139526766-d97ceb6e-d6b0-4840-bf5a-b801710cfabb.jpeg)

        
    - 네이버 reverse geocoding 연결(현재위치 주소 조회 관련)
        
        reverse geocoding: 위도와 경도 정보를 이용하여 주소로 역변환해주는 기능
        → 이것과 반대되는 기능: geocoding(주소정보를 이용해 좌표를 포함한 상세정보로 변환해주는 기능)
        → 이러한 기능들은 지도 api 서비스를 제공하는 업체에서는 거의 전부 다 제공함
        
        - 실행코드
            
            ```jsx
            export const NaverReverseGeocoding = (coords) => {
            		// coords 파라메터 자료형은 String
            		// 형식은 '${경도},${위도}' 형식으로 들어가야 함
                return new Promise((resolve) => {
                    fetch(`https://naveropenapi.apigw.ntruss.com/map-reversegeocode/v2/gc?coords=${coords}&orders=legalcode&output=json`, {
                        headers: {
                            'X-NCP-APIGW-API-KEY-ID': CLIENT_ID,  // 네이버 client ID
                            'X-NCP-APIGW-API-KEY': CLIENT_SECRET  // 네이버 client secret
                        }
                    })
                    .then((res) => {
            						// json 결과값을 js 객체로 역변환해서 반환
                        resolve(res.json());
                    })
                });
            }
            ```
            
    - gps 기능
        - 안드로이드 권한 설정
            - AndroidManifest.xml 파일에 <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" /> 코드 추가
        - ios 권한 설정
            - info.plist 파일에 아래의 코드 추가
                
                ```jsx
                <key>NSLocationWhenInUseUsageDescription</key>
                <string>{위치 권한과 관련해 사용자에게 보여질 문장}</string>
                ```
                
        - gps 모듈 설치
            
            모듈명: react-native-geolocation-service
            참고) 이 모듈을 통해 ios의 위치 설정 권한을 요청할 수 있음(안드로이드는 react native에서 제공하는 별도 컴포넌트가 있음)
            
        - 권한 요청 메서드 작성
            
            ```jsx
            const requestPermission = async () => {
                try {
                  if(Platform.OS === 'android') return await PermissionsAndroid.request(PermissionsAndroid.PERMISSIONS.ACCESS_FINE_LOCATION);
                  else return await Geolocation.requestAuthorization('whenInUse');
            
            			//return 값: granted(허용), denied(거부), never_ask_again(다시 묻지 않음(거부)), disabled(사용불가), restricted(사용제한)
                }
                catch(e) {
                  console.log('HomeContainer requestPermission: ', e);
                }
              }
            ```
            
        - 위치정보 요청 메서드 작성
            
            ```jsx
            const getCoordinate = (res, catArr) => {
                if(res === 'granted') {
                  Geolocation.getCurrentPosition((pos) => {
                    const {longitude, latitude} = pos.coords;
                    console.log('pos: ', latitude, longitude);
                    
                  },
                  error => {
                    console.log('===================================================');
                    console.log('getCoordinate error: ', error);
                  },
                  {
                    timeout: 1000, // 타임아웃(ms) => ios에선 타임아웃을 안걸어주면 위치 반환이 안됨: 타임아웃 default가 INFINITY(무한대)이기 때문
                    enableHighAccuracy: true // 위치 고정밀 조회 사용여부
                  })
                }
                else { }
              }
            ```
            
        

### 앱 메인화면

- 메인화면 ui 전면 재설계
    - **변경 전**
        
        <img width="377" alt="스크린샷 2021-10-30 오후 5 22 26" src="https://user-images.githubusercontent.com/73742422/139526789-e9a5a4fe-0cf3-4817-8997-dae45597455c.png">
        
    - **변경 후**
        
        ![KakaoTalk_Photo_2021-10-29-23-43-35 014](https://user-images.githubusercontent.com/73742422/139526798-b676b983-3add-475a-8af4-bfc2a6fb0e82.jpeg)
        
        - ui 구조 변경
        - 캐러셀 **자체 제작** 후 연결
        - 메인화면 노출 날짜별 추천 1개 노출 → 반려공감 리스트 형으로 변경

### 반려공감

- 반려공감 전면 재설계
    - **변경 전 ui**
        
        <img width="376" alt="스크린샷 2021-10-30 오후 5 30 17" src="https://user-images.githubusercontent.com/73742422/139526811-9be308ae-e651-4c46-9b62-6a7a5f27a4c2.png">
        
    - **변경 후 ui**
        
        ![KakaoTalk_Photo_2021-10-29-23-43-35 012](https://user-images.githubusercontent.com/73742422/139526819-5a20bd93-856e-4a97-baee-77634dd70f37.jpeg)

        
        - 카테고리 구조: 1 depth → 3depth 구조로 변경
        - 반려공감 자체 검색기능 추가
        - 아이템 컴포넌트 ui 수정
